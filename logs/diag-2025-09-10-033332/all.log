▶️  Iniciando diagnóstico 2025-09-10-033332

=== Contexto Git ===
## fix/supabase-sync-250910-0131
 D .eslintrc.json
 M .eslintrc.json.bak
 M app/(app)/pacientes/[id]/page.tsx
 M app/(app)/pacientes/page.tsx
 M app/(app)/test-ui/page.tsx
 M app/(app)/test-ui/upload/page.tsx
 M app/(auth)/register/page.tsx
 M app/(auth)/reset-password/page.tsx
 M app/(auth)/update-password/page.tsx
 M components/ExportPDFButton.tsx
 M components/OrgSwitcherBadge.tsx
 M components/RegisterSW.tsx
 M lib/database.types.ts
 M lib/patient-files.ts
 M lib/patients.ts
 M lib/supabase-browser.ts
 M lib/supabase/client.ts
 M logs/diag-2025-09-10-013258/snapshot/app/(app)/pacientes/[id]/page.tsx
 M logs/diag-2025-09-10-013258/snapshot/app/(app)/pacientes/page.tsx
 M logs/diag-2025-09-10-013258/snapshot/app/(app)/test-ui/upload/page.tsx
 M logs/diag-2025-09-10-013258/snapshot/components/ExportPDFButton.tsx
 M logs/diag-2025-09-10-013258/snapshot/components/OrgSwitcherBadge.tsx
 M package.json
 M tsconfig.json
?? eslint.config.js
?? full_dump.sql
?? logs/diag-2025-09-10-031752/
?? logs/diag-2025-09-10-033332/
?? package.json.bak
?? schema_public.sql
?? tsconfig.json.bak
?? tsconfig.typecheck.json
5b986cba9e913f5599306a7ad6b262e56f0220c0
commit 5b986cba9e913f5599306a7ad6b262e56f0220c0
Author:     Sanoa <martin.maldonado32@gmail.com>
AuthorDate: Wed Sep 10 02:43:32 2025 +0000
Commit:     Sanoa <martin.maldonado32@gmail.com>
CommitDate: Wed Sep 10 02:43:32 2025 +0000

    chore: relax eslint any->warn, ts useUnknownInCatchVariables, fix RegisterSW parse, tipar setGenero

=== Versiones básicas ===
v22.17.0
9.8.1
10.13.1
1.22.22

  System:
    OS: Linux 6.8 Ubuntu 24.04.2 LTS 24.04.2 LTS (Noble Numbat)
    CPU: (2) x64 AMD EPYC 7763 64-Core Processor
    Memory: 5.48 GB / 7.76 GB
    Container: Yes
    Shell: 5.2.21 - /bin/bash
  Binaries:
    Node: 22.17.0 - ~/nvm/current/bin/node
    Yarn: 1.22.22 - /usr/bin/yarn
    npm: 9.8.1 - ~/nvm/current/bin/npm
    pnpm: 10.13.1 - ~/nvm/current/bin/pnpm


=== Paquetes del proyecto ===
{
  "deps": {
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-slot": "^1.2.3",
    "@sentry/nextjs": "^10.11.0",
    "@supabase/auth-helpers-nextjs": "0.10.0",
    "@supabase/supabase-js": "2.57.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "html2canvas": "^1.4.1",
    "jspdf": "^3.0.2",
    "lucide-react": "^0.542.0",
    "next": "15.5.2",
    "react": "19.1.0",
    "react-dom": "19.1.0",
    "tailwind-merge": "^3.3.1",
    "tailwindcss-animate": "^1.0.7"
  },
  "devDeps": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20.19.13",
    "@types/react": "^19.1.12",
    "@types/react-dom": "^19",
    "eslint": "^9.35.0",
    "eslint-config-next": "^15.5.2",
    "eslint-config-prettier": "^10.1.8",
    "eslint-plugin-import": "^2.32.0",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^5.2.0",
    "prettier": "^3.6.2",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.3.8",
    "typescript": "^5"
  }
}

=== Variables de entorno (enmascaradas) ===
--- .env.local ---
NEXT_PUBLIC_SUPABASE_URL=***MASKED***
NEXT_PUBLIC_SUPABASE_ANON_KEY=***MASKED***
NEXT_PUBLIC_SITE_URL=***MASKED***
NEXT_PUBLIC_APP_VERSION=***MASKED***
NEXT_PUBLIC_UPLOAD_MAX_MB=***MASKED***
NEXT_PUBLIC_UPLOAD_ALLOWED=***MASKED***
NEXT_PUBLIC_SIGNED_URL_TTL=***MASKED***
NEXT_PUBLIC_SENTRY_DSN=***MASKED***
NEXT_PUBLIC_SENTRY_ENV=***MASKED***

=== Configuración de Next/TS/ESLint ===
--- next.config.ts ---
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
--- tsconfig.json ---
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "baseUrl": ".",
    "useUnknownInCatchVariables": false
  },
  "include": [
    "app",
    "components",
    "lib",
    "scripts",
    "types",
    "next-env.d.ts"
  ],
  "exclude": [
    "node_modules",
    ".next",
    "logs/**",
    "logs"
  ]
}
--- .prettierrc.json ---
{
  "semi": true,
  "singleQuote": false,
  "printWidth": 100,
  "tabWidth": 2,
  "trailingComma": "all"
}

=== tsconfig efectivo (tsc --showConfig) ===
tsconfig efectivo guardado.

=== ESLint efectivo para un archivo conflictivo ===

Oops! Something went wrong! :(

ESLint: 9.35.0

Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'typescript-eslint' imported from /workspaces/sanoa-lab/eslint.config.js
    at Object.getPackageJSONURL (node:internal/modules/package_json_reader:256:9)
    at packageResolve (node:internal/modules/esm/resolve:768:81)
    at moduleResolve (node:internal/modules/esm/resolve:854:18)
    at defaultResolve (node:internal/modules/esm/resolve:984:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:780:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:704:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:687:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:305:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:175:49)
(node:32609) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///workspaces/sanoa-lab/eslint.config.js?mtime=1757475147201 is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /workspaces/sanoa-lab/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)

=== Greps rápidos (pistas de errores) ===
-- usos de storage_key --
lib/database.types.ts:53:          storage_key: string;   // <- en tu código antes ponía "path"
lib/database.types.ts:63:          storage_key: string;
lib/database.types.ts:73:          storage_key: string;
lib/patient-files.ts:7:  storage_key: string;
lib/patient-files.ts:107:      storage_key: key,
lib/patient-files.ts:132:  const { data, error } = await supabase.storage.from("uploads").createSignedUrl(rec.storage_key, sec);
lib/patient-files.ts:146:    .select("id, storage_key")
lib/patient-files.ts:150:  const key = rec!.storage_key as string;
-- usos de EmojiPerItem --
-- imports getSupabaseClient (posible import incorrecto) --
-- ocurrencias ': any' en TS/TSX --
lib/supabase/client.ts:6:export function getSupabaseServer(): any {
lib/patients.ts:13:function raise(error: any): never {
lib/audit.ts:11:  data: any | null;
lib/supabase-browser.ts:5:let _client: any = null;
components/InstallPrompt.tsx:13:    const handler = (e: any) => {
components/OrgSwitcherBadge.tsx:23:    const onChanged = (e: any) => setCurrent(e.detail?.orgId || null);
-- console.error(…) --
grep: Unmatched ( or \(
-- enums Gender tipado --

=== Snapshot de archivos relevantes (para revisar tipos/llamadas) ===
  ✓ lib/database.types.ts
  ✓ lib/supabase-browser.ts
  ✓ lib/supabase/client.ts
  ✓ lib/types.ts
  ✓ lib/patients.ts
  ✓ lib/patient-files.ts
  ✓ lib/patient-notes.ts
  ✓ lib/patient-shares.ts
  ✓ lib/org.ts
  ✓ lib/audit.ts
  ✓ config/emojiTheme.ts
  ✓ components/EmojiTheme.tsx
  ✓ components/OrgSwitcherBadge.tsx
  ✓ components/InstallPrompt.tsx
  ✓ components/ExportPDFButton.tsx
  ✓ components/Toast.tsx
  ✓ app/(app)/pacientes/[id]/page.tsx
  ✓ app/(app)/pacientes/page.tsx
  ✓ app/(app)/perfil/page.tsx
  ✓ app/(app)/test-ui/upload/page.tsx

=== Estado Supabase CLI (si está instalada) ===
⚠️  Supabase CLI no encontrada (opcional). Instalar: npm i -g supabase

=== Linter ===

> sanoa-lab@0.1.0 format
> prettier --write "**/*.{ts,tsx,js,jsx,json,css,md}"

.prettierrc.json 137ms (unchanged)
app/(app)/dashboard/page.tsx 136ms (unchanged)
app/(app)/layout.tsx 11ms (unchanged)
app/(app)/pacientes/[id]/page.tsx 338ms
app/(app)/pacientes/page.tsx 59ms
app/(app)/perfil/page.tsx 93ms (unchanged)
app/(app)/test-ui/page.tsx 80ms
app/(app)/test-ui/upload/page.tsx 53ms
app/(auth)/login/page.tsx 34ms (unchanged)
app/(auth)/register/page.tsx 19ms
app/(auth)/reset-password/page.tsx 13ms
app/(auth)/update-password/page.tsx 50ms
app/acerca/page.tsx 2ms (unchanged)
app/api/sentry-debug/route.ts 2ms (unchanged)
app/error.tsx 9ms (unchanged)
app/globals.css 60ms (unchanged)
app/head.tsx 10ms (unchanged)
app/instalar/page.tsx 44ms (unchanged)
app/layout.tsx 7ms (unchanged)
app/manifest.ts 3ms (unchanged)
app/not-found.tsx 3ms (unchanged)
app/offline/page.tsx 38ms (unchanged)
app/page.tsx 3ms (unchanged)
app/privacidad/page.tsx 6ms (unchanged)
app/providers.tsx 3ms (unchanged)
app/robots.ts 4ms (unchanged)
app/sitemap.ts 6ms (unchanged)
app/terminos/page.tsx 4ms (unchanged)
components.json 3ms (unchanged)
components/AppShell.tsx 2ms (unchanged)
components/AuthGate.tsx 18ms (unchanged)
components/ColorEmoji.tsx 86ms (unchanged)
components/Emoji.tsx 6ms (unchanged)
components/EmojiTheme.tsx 12ms (unchanged)
components/ExportPDFButton.tsx 20ms (unchanged)
components/InstallPrompt.tsx 10ms (unchanged)
components/Modal.tsx 6ms (unchanged)
components/Navbar.tsx 15ms (unchanged)
components/OfflineIndicator.tsx 2ms (unchanged)
components/OrgSwitcherBadge.tsx 15ms
components/PendingQueueBadge.tsx 8ms (unchanged)
components/QueueEvents.tsx 21ms (unchanged)
components/RegisterSW.tsx 9ms
components/RequireAuth.tsx 19ms (unchanged)
components/SiteFooter.tsx 7ms (unchanged)
components/ThemeToggle.tsx 7ms (unchanged)
components/Toast.tsx 43ms (unchanged)
components/Toaster.tsx 19ms (unchanged)
components/ui/button.tsx 6ms (unchanged)
components/ui/card.tsx 8ms (unchanged)
components/ui/input.tsx 1ms (unchanged)
components/ui/label.tsx 2ms (unchanged)
components/UiCard.tsx 3ms (unchanged)
components/UploadHint.tsx 5ms (unchanged)
config/emojiTheme.ts 12ms (unchanged)
eslint.config.js 8ms
hooks/useNotesRealtime.ts 6ms (unchanged)
hooks/usePatientsRealtime.ts 6ms (unchanged)
lib/audit.ts 12ms (unchanged)
lib/database.types.ts 20ms
lib/org.ts 9ms (unchanged)
lib/patient-files.ts 33ms
lib/patient-notes.ts 5ms (unchanged)
lib/patient-shares.ts 5ms (unchanged)
lib/patients-search.ts 9ms (unchanged)
lib/patients.ts 9ms
lib/storage.ts 3ms (unchanged)
lib/supabase-browser.ts 2ms (unchanged)
lib/supabase/client.ts 3ms (unchanged)
lib/types.ts 4ms (unchanged)
lib/utils.ts 13ms (unchanged)
logs/diag-2025-09-10-013258/.eslintrc.json 2ms (unchanged)
logs/diag-2025-09-10-013258/.prettierrc.json 3ms (unchanged)
logs/diag-2025-09-10-013258/eslint.effective.pacientes-id.json 54ms (unchanged)
logs/diag-2025-09-10-013258/eslint.json 222ms (unchanged)
logs/diag-2025-09-10-013258/next.config.ts 2ms (unchanged)
logs/diag-2025-09-10-013258/package.deps.json 2ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/app/(app)/pacientes/[id]/page.tsx 116ms
logs/diag-2025-09-10-013258/snapshot/app/(app)/pacientes/page.tsx 58ms
logs/diag-2025-09-10-013258/snapshot/app/(app)/perfil/page.tsx 32ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/app/(app)/test-ui/upload/page.tsx 32ms
logs/diag-2025-09-10-013258/snapshot/components/EmojiTheme.tsx 2ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/components/ExportPDFButton.tsx 6ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/components/InstallPrompt.tsx 10ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/components/OrgSwitcherBadge.tsx 9ms
logs/diag-2025-09-10-013258/snapshot/components/Toast.tsx 20ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/config/emojiTheme.ts 6ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/audit.ts 9ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/database.types.ts 9ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/org.ts 17ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/patient-files.ts 34ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/patient-notes.ts 13ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/patient-shares.ts 17ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/patients.ts 17ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/supabase-browser.ts 8ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/supabase/client.ts 3ms (unchanged)
logs/diag-2025-09-10-013258/snapshot/lib/types.ts 7ms (unchanged)
logs/diag-2025-09-10-013258/tsconfig.effective.json 3ms (unchanged)
logs/diag-2025-09-10-013258/tsconfig.json 6ms (unchanged)
logs/diag-2025-09-10-031752/.eslintrc.json 1ms (unchanged)
logs/diag-2025-09-10-031752/.prettierrc.json 4ms (unchanged)
logs/diag-2025-09-10-031752/eslint.effective.pacientes-id.json 28ms
logs/diag-2025-09-10-031752/next.config.ts 3ms (unchanged)
logs/diag-2025-09-10-031752/package.deps.json 3ms (unchanged)
logs/diag-2025-09-10-031752/tsconfig.effective.json 5ms
logs/diag-2025-09-10-031752/tsconfig.json 1ms
logs/diag-2025-09-10-033332/.prettierrc.json 1ms (unchanged)
logs/diag-2025-09-10-033332/eslint.effective.pacientes-id.json 1ms (unchanged)
logs/diag-2025-09-10-033332/next.config.ts 1ms (unchanged)
logs/diag-2025-09-10-033332/package.deps.json 1ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/app/(app)/pacientes/[id]/page.tsx 191ms
logs/diag-2025-09-10-033332/snapshot/app/(app)/pacientes/page.tsx 119ms
logs/diag-2025-09-10-033332/snapshot/app/(app)/perfil/page.tsx 45ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/app/(app)/test-ui/upload/page.tsx 29ms
logs/diag-2025-09-10-033332/snapshot/components/EmojiTheme.tsx 3ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/components/ExportPDFButton.tsx 6ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/components/InstallPrompt.tsx 5ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/components/OrgSwitcherBadge.tsx 16ms
logs/diag-2025-09-10-033332/snapshot/components/Toast.tsx 21ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/config/emojiTheme.ts 10ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/audit.ts 5ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/database.types.ts 13ms
logs/diag-2025-09-10-033332/snapshot/lib/org.ts 8ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/patient-files.ts 24ms
logs/diag-2025-09-10-033332/snapshot/lib/patient-notes.ts 11ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/patient-shares.ts 10ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/patients.ts 10ms
logs/diag-2025-09-10-033332/snapshot/lib/supabase-browser.ts 1ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/supabase/client.ts 2ms (unchanged)
logs/diag-2025-09-10-033332/snapshot/lib/types.ts 3ms (unchanged)
logs/diag-2025-09-10-033332/tsconfig.effective.json 3ms
logs/diag-2025-09-10-033332/tsconfig.json 1ms
middleware.ts 1ms (unchanged)
next.config.ts 1ms (unchanged)
package-lock.json 85ms (unchanged)
package.json 1ms (unchanged)
README.md 55ms (unchanged)
sentry.client.config.ts 3ms (unchanged)
sentry.server.config.ts 4ms (unchanged)
tsconfig.json 1ms
tsconfig.typecheck.json 1ms (unchanged)

Oops! Something went wrong! :(

ESLint: 9.35.0

Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'typescript-eslint' imported from /workspaces/sanoa-lab/eslint.config.js
    at Object.getPackageJSONURL (node:internal/modules/package_json_reader:256:9)
    at packageResolve (node:internal/modules/esm/resolve:768:81)
    at moduleResolve (node:internal/modules/esm/resolve:854:18)
    at defaultResolve (node:internal/modules/esm/resolve:984:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:780:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:704:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:687:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:305:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:175:49)
(node:32811) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///workspaces/sanoa-lab/eslint.config.js?mtime=1757475218544 is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /workspaces/sanoa-lab/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)

Oops! Something went wrong! :(

ESLint: 9.35.0

Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'typescript-eslint' imported from /workspaces/sanoa-lab/eslint.config.js
    at Object.getPackageJSONURL (node:internal/modules/package_json_reader:256:9)
    at packageResolve (node:internal/modules/esm/resolve:768:81)
    at moduleResolve (node:internal/modules/esm/resolve:854:18)
    at defaultResolve (node:internal/modules/esm/resolve:984:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:780:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:704:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:687:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:305:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:175:49)
(node:32835) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///workspaces/sanoa-lab/eslint.config.js?mtime=1757475218544 is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /workspaces/sanoa-lab/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)
Logs de ESLint en logs/diag-2025-09-10-033332/eslint.*

=== TypeScript (tsc -noEmit) ===
lib/audit.ts(18,11): error TS2769: No overload matches this call.
  Overload 1 of 2, '(relation: "patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; ... 4 more ...; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, { ...; } | ... 3 more ... | { ...; }, "patients" | ... 3 more ... | "user_org_prefs", []>', gave the following error.
    Argument of type '"audit_log"' is not assignable to parameter of type '"patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"'.
  Overload 2 of 2, '(relation: never): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; edad: number | null; genero: Gender | null; created_at: string; updated_at: string | null; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, never, never, never>', gave the following error.
    Argument of type '"audit_log"' is not assignable to parameter of type 'never'.
lib/org.ts(15,47): error TS2769: No overload matches this call.
  Overload 1 of 2, '(relation: "patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; ... 4 more ...; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, { ...; } | ... 3 more ... | { ...; }, "patients" | ... 3 more ... | "user_org_prefs", []>', gave the following error.
    Argument of type '"v_my_orgs"' is not assignable to parameter of type '"patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"'.
  Overload 2 of 2, '(relation: never): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; edad: number | null; genero: Gender | null; created_at: string; updated_at: string | null; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, never, never, never>', gave the following error.
    Argument of type '"v_my_orgs"' is not assignable to parameter of type 'never'.
lib/org.ts(17,10): error TS2352: Conversion of type '(SelectQueryError<"column 'id' does not exist on 'patients'."> | SelectQueryError<"column 'id' does not exist on 'patient_files'."> | SelectQueryError<...> | SelectQueryError<...> | SelectQueryError<...>)[]' to type 'MyOrg[]' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.
  Type 'SelectQueryError<"column 'id' does not exist on 'patients'."> | SelectQueryError<"column 'id' does not exist on 'patient_files'."> | SelectQueryError<...> | SelectQueryError<...> | SelectQueryError<...>' is not comparable to type 'MyOrg'.
    Type '{ error: true; } & String' is missing the following properties from type 'MyOrg': id, name, slug, is_personal, role
lib/org.ts(28,11): error TS2769: No overload matches this call.
  Overload 1 of 2, '(relation: "patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; ... 4 more ...; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, { ...; } | ... 3 more ... | { ...; }, "patients" | ... 3 more ... | "user_org_prefs", []>', gave the following error.
    Argument of type '"user_prefs"' is not assignable to parameter of type '"patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"'.
  Overload 2 of 2, '(relation: never): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; edad: number | null; genero: Gender | null; created_at: string; updated_at: string | null; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, never, never, never>', gave the following error.
    Argument of type '"user_prefs"' is not assignable to parameter of type 'never'.
lib/org.ts(32,23): error TS2339: Property 'current_org_id' does not exist on type 'SelectQueryError<"column 'current_org_id' does not exist on 'patients'."> | SelectQueryError<"column 'current_org_id' does not exist on 'patient_files'."> | SelectQueryError<...> | SelectQueryError<...> | SelectQueryError<...>'.
  Property 'current_org_id' does not exist on type 'SelectQueryError<"column 'current_org_id' does not exist on 'patients'.">'.
lib/org.ts(33,39): error TS2339: Property 'current_org_id' does not exist on type 'SelectQueryError<"column 'current_org_id' does not exist on 'patients'."> | SelectQueryError<"column 'current_org_id' does not exist on 'patient_files'."> | SelectQueryError<...> | SelectQueryError<...> | SelectQueryError<...>'.
  Property 'current_org_id' does not exist on type 'SelectQueryError<"column 'current_org_id' does not exist on 'patients'.">'.
lib/org.ts(34,17): error TS2339: Property 'current_org_id' does not exist on type 'SelectQueryError<"column 'current_org_id' does not exist on 'patients'."> | SelectQueryError<"column 'current_org_id' does not exist on 'patient_files'."> | SelectQueryError<...> | SelectQueryError<...> | SelectQueryError<...>'.
  Property 'current_org_id' does not exist on type 'SelectQueryError<"column 'current_org_id' does not exist on 'patients'.">'.
lib/org.ts(55,11): error TS2769: No overload matches this call.
  Overload 1 of 2, '(relation: "patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; ... 4 more ...; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, { ...; } | ... 3 more ... | { ...; }, "patients" | ... 3 more ... | "user_org_prefs", []>', gave the following error.
    Argument of type '"user_prefs"' is not assignable to parameter of type '"patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"'.
  Overload 2 of 2, '(relation: never): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; edad: number | null; genero: Gender | null; created_at: string; updated_at: string | null; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, never, never, never>', gave the following error.
    Argument of type '"user_prefs"' is not assignable to parameter of type 'never'.
lib/patient-notes.ts(31,6): error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: { id?: string | undefined; user_id: string; patient_id: string; content: string; created_at?: string | undefined; }, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Argument of type '{ patient_id: string; content: string; }' is not assignable to parameter of type '{ id?: string | undefined; user_id: string; patient_id: string; content: string; created_at?: string | undefined; }'.
      Property 'user_id' is missing in type '{ patient_id: string; content: string; }' but required in type '{ id?: string | undefined; user_id: string; patient_id: string; content: string; created_at?: string | undefined; }'.
  Overload 2 of 2, '(values: { id?: string | undefined; user_id: string; patient_id: string; content: string; created_at?: string | undefined; }[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Object literal may only specify known properties, and 'patient_id' does not exist in type '{ id?: string | undefined; user_id: string; patient_id: string; content: string; created_at?: string | undefined; }[]'.
lib/patient-shares.ts(23,10): error TS2352: Conversion of type '{ id: string; user_id: string; patient_id: string; token: string; expires_at: string | null; created_at: string; }[]' to type 'PatientShare[]' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.
  Type '{ id: string; user_id: string; patient_id: string; token: string; expires_at: string | null; created_at: string; }' is missing the following properties from type 'PatientShare': owner_id, grantee_email, can_edit
lib/patient-shares.ts(38,13): error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: { id?: string | undefined; user_id: string; patient_id: string; token: string; expires_at?: string | null | undefined; created_at?: string | undefined; }, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Argument of type '{ owner_id: string; patient_id: string; grantee_email: string; can_edit: boolean; }' is not assignable to parameter of type '{ id?: string | undefined; user_id: string; patient_id: string; token: string; expires_at?: string | null | undefined; created_at?: string | undefined; }'.
      Type '{ owner_id: string; patient_id: string; grantee_email: string; can_edit: boolean; }' is missing the following properties from type '{ id?: string | undefined; user_id: string; patient_id: string; token: string; expires_at?: string | null | undefined; created_at?: string | undefined; }': user_id, token
  Overload 2 of 2, '(values: { id?: string | undefined; user_id: string; patient_id: string; token: string; expires_at?: string | null | undefined; created_at?: string | undefined; }[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Argument of type '{ owner_id: string; patient_id: string; grantee_email: string; can_edit: boolean; }' is not assignable to parameter of type '{ id?: string | undefined; user_id: string; patient_id: string; token: string; expires_at?: string | null | undefined; created_at?: string | undefined; }[]'.
      Type '{ owner_id: string; patient_id: string; grantee_email: string; can_edit: boolean; }' is missing the following properties from type '{ id?: string | undefined; user_id: string; patient_id: string; token: string; expires_at?: string | null | undefined; created_at?: string | undefined; }[]': length, pop, push, concat, and 35 more.
lib/patient-shares.ts(45,10): error TS2352: Conversion of type '{ id: string; user_id: string; patient_id: string; token: string; expires_at: string | null; created_at: string; }' to type 'PatientShare' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.
  Type '{ id: string; user_id: string; patient_id: string; token: string; expires_at: string | null; created_at: string; }' is missing the following properties from type 'PatientShare': owner_id, grantee_email, can_edit
lib/patients.ts(6,25): error TS2440: Import declaration conflicts with local declaration of 'Gender'.

=== Build Next.js (Turbopack) ===
   ▲ Next.js 15.5.2 (Turbopack)
   - Environments: .env.local

   Creating an optimized production build ...
 ✓ Finished writing to disk in 96ms
 ✓ Compiled successfully in 15.3s
   Linting and checking validity of types ...

   We detected TypeScript in your project and reconfigured your tsconfig.json file for you.
   The following suggested values were added to your tsconfig.json. These values can be changed to fit your project's needs:

   	- include was updated to add '.next/types/**/*.ts'

 ⨯ ESLint: Cannot find package 'typescript-eslint' imported from /workspaces/sanoa-lab/eslint.config.js
(node:33333) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///workspaces/sanoa-lab/eslint.config.js?mtime=1757475218544 is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /workspaces/sanoa-lab/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)
Failed to compile.

./lib/audit.ts:18:11
Type error: No overload matches this call.
  Overload 1 of 2, '(relation: "patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; ... 4 more ...; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, { ...; } | ... 3 more ... | { ...; }, "patients" | ... 3 more ... | "user_org_prefs", []>', gave the following error.
    Argument of type '"audit_log"' is not assignable to parameter of type '"patients" | "patient_files" | "patient_notes" | "patient_shares" | "user_org_prefs"'.
  Overload 2 of 2, '(relation: never): PostgrestQueryBuilder<{ PostgrestVersion: "12"; }, { Tables: { patients: { Row: { id: string; nombre: string; edad: number | null; genero: Gender | null; created_at: string; updated_at: string | null; user_id?: string | ... 1 more ... | undefined; }; Insert: { ...; }; Update: Partial<...>; Relationships: []; }; patient_files: { ...; }; patient_notes: { ...; }; patient_shares: { ...; }; user_org_prefs: { ...; }; }; Views: {}; Functions: {}; Enums: { ...; }; }, never, never, never>', gave the following error.
    Argument of type '"audit_log"' is not assignable to parameter of type 'never'.

[0m [90m 16 |[39m   [36mconst[39m supabase [33m=[39m getSupabaseBrowser()[33m;[39m
 [90m 17 |[39m   [36mconst[39m { data[33m,[39m error } [33m=[39m [36mawait[39m supabase
[31m[1m>[22m[39m[90m 18 |[39m     [33m.[39m[36mfrom[39m([32m"audit_log"[39m)
 [90m    |[39m           [31m[1m^[22m[39m
 [90m 19 |[39m     [33m.[39mselect([32m"*"[39m)
 [90m 20 |[39m     [33m.[39meq([32m"patient_id"[39m[33m,[39m patientId)
 [90m 21 |[39m     [33m.[39morder([32m"created_at"[39m[33m,[39m { ascending[33m:[39m [36mfalse[39m })[0m
Next.js build worker exited with code: 1 and signal: null

=== Conteos rápidos ===
Archivos TS/TSX:
66
Coincidencias ': any' (aprox):
6 logs/diag-2025-09-10-033332/colon-any.txt

=== Comprimir resultados ===
📦 Paquete generado: logs/diag-2025-09-10-033332.tgz

✅ Diagnóstico finalizado. Comparte:
  1) logs/diag-2025-09-10-033332/all.log
  2) logs/diag-2025-09-10-033332.tgz  (contiene todo lo anterior)
